---
title: "Portfolio 3"
author: "Cassandra Richardson"
date: "5/4/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

drugs <- read.csv(here::here("C:/Users/cassr/GitHub/project3/data/drug-use-by-age.csv"))

library(ggplot2)
library(dplyr)
library(tidyverse)
library(ggrepel)
```


# **Cassandra Richardson's Portfolio Piece #3 - Data Analysis Report on Common Drug Use by Age**


# Step 1: Finding a dataset.

### The dataset I will be using for this project is "drug-use-by-age" from the FiveThirtyEight datasets. This data was sourced by the National Survey on Drug Use and Health from the Substance Abuse and Mental Health Data Archive. The data can be found here: https://github.com/fivethirtyeight/data/tree/master/drug-use-by-age 

### Dataset description: This dataset covers usage of 13 different drugs across 17 age groups. For each drug, there is information about the "use," which is the percentage of those in an age group that have used that drug in the last 12 months, and "frequency," which is the median number of times a user in that age group used that drug in the past 12 months. 


# Step 2: Develop a research plan.

### For this data analysis report, I want to examine the usage of three drugs: alcohol, marijuana, and hallucinogens. My rationale for choosing these drugs is that I expect the perceptions of each drug to vary across age. Alcohol is the most common drug in the US, and views on marijuana and hallucinogens have been changing in recent years as their therapeutic benefits are being recognized, with laws reflecting this through their legalization or decriminalization. 

### With these three variables, I want to examine trends in both use and frequency across age groups. 

### Hypotheses: 
1. Alcohol use will not significantly differ with age, but frequency will significantly differ by age. 
2. Marijuana use will be significantly different by age, but frequency will not significantly differ by age. 
3. Hallucinogen use will be significantly different by age, but frequency will not signficantly differ by age. 


# Step 3: Before we begin any analyses, let's examine what this dataset includes:

```{r exploring dogs}
#View(drugs)
summary(drugs)
```

### The "view()" function opens the full dataset file in a new tab, so we can visually examine what the data looks like. 

### The "summary()" function gives us the min, max, 1st quartile, mean, and 3rd quartile for all quantitative variables. However, it looks like some of our variables are character variables when they should be numeric - we will need to change this in our data cleaning. 


# Step 4: Let's explore some more characteristics about the data:

```{r data characteristics}
glimpse(drugs)
head(drugs)
names(drugs)
missing <- !complete.cases(drugs)
drugs[missing]
```

### - glimpse() shows us an overview of the whole dataset. We see that there are 17 rows and 28 columns.
### - head() gives us the first 6 rows of data
### - names() tells us all of the variable names
### - missing <- !complete.cases() creates an object/tibble called "missing" with any missing observations across the entire dataset
### - drugs[missing] shows us that the "missing" tibble has 0 columns. This means that there was no missing data in this dataset, which makes it easier to work with! However, when I looked at the data through the "View()" function, I noticed there is at least one breed with values of "-" which will need to be removed during data cleaning.



# Step 5: Before we begin our analyses, let's **clean the data**! 

### First, I want to remove the values of "not found":

```{r removing}
drugs_clean <- na_if(drugs, "-")
#View(drugs_clean)
```

### Perfect! Looking at the new datset, we see that all values of "-" were replaced with NA. 

### Although we won't be using all drugs in our analyses, let's still fix them for the sake of cleaning the data and making it easier for future analyses. As such, let's change the character variables to numeric variables: 

```{r numeric}
sapply(drugs_clean, class)

drugs_clean$cocaine.frequency <- as.numeric(drugs_clean$cocaine.frequency) 
drugs_clean$crack.frequency <- as.numeric(drugs_clean$crack.frequency) 
drugs_clean$heroin.frequency <- as.numeric(drugs_clean$heroin.frequency) 
drugs_clean$inhalant.frequency <- as.numeric(drugs_clean$inhalant.frequency)
drugs_clean$oxycontin.frequency <- as.numeric(drugs_clean$oxycontin.frequency) 
drugs_clean$meth.frequency <- as.numeric(drugs_clean$meth.frequency) 

sapply(drugs_clean, class)
```

### For the sake of having a smaller, more targeted dataset, let's subset "drugs_clean" to only include our variables of interest:

```{r cleaning more}
drugs_cleaner <- subset(drugs_clean, select=c(age, n, alcohol.use, alcohol.frequency, marijuana.use, marijuana.frequency, hallucinogen.use, hallucinogen.frequency))
```

# Data cleaning is complete! To clean the data, I did the following steps:
1. Removed missing values
2. Converted character variables to numeric variables
3. Created a subset of the variables we will be using



# Step 6: Now let's visualize our data using scatterplots.

```{r alcohol scatterplot}
ggplot(drugs2) +
  aes(x = alcohol.use,
      y = alcohol.frequency,
      fill = age, 
      color = age) +
  geom_jitter(alpha = .6) +
  labs(
    title = "Alcohol Use by Age in Past 12 Months",
    x = "Percentage in Age Group that Used Alcohol",
    y = "Median # Times Used Alcohol") +
  geom_text_repel(aes(label = age),
                  box.padding = .5,
                  direction = "y",
                  size = 2.5,
                  max.overlaps = Inf)
```

```{r marijuana scatterplot}
ggplot(drugs2) +
  aes(x = marijuana.use,
      y = marijuana.frequency,
      fill = age, 
      color = age) +
  geom_jitter(alpha = .6) +
  labs(
    title = "Marijuana Use by Age in Past 12 Months",
    x = "Percentage in Age Group that Used Marijuana",
    y = "Median # Times Used Marijuana") +
  geom_text_repel(aes(label = age),
                  box.padding = .5,
                  direction = "y",
                  size = 2.5,
                  max.overlaps = Inf)
```

```{r hallucinogen scatterplot}
ggplot(drugs2) +
  aes(x = hallucinogen.use,
      y = hallucinogen.frequency,
      fill = age, 
      color = age) +
  geom_jitter(alpha = .6) +
  labs(
    title = "Hallucinogen Use by Age in Past 12 Months",
    x = "Percentage in Age Group that Used Hallucinogens",
    y = "Median # Times Used Hallucinogens") +
  geom_text_repel(aes(label = age),
                  box.padding = .5,
                  direction = "y",
                  size = 2.5,
                  max.overlaps = Inf)
```



# Step 7: Let's perform the Chi-square test of independence to see if there are the relationships between drug use and age, and drug frequency and age, per my hypotheses:

```{r alcohol use and age correlation}
alc_use_chisq <- chisq.test(drugs_clean$alcohol.use, drugs_clean$age)

alc_use_chisq
```

```{r alcohol frequency and age correlation}
alc_freq_chisq <- chisq.test(drugs_clean$alcohol.frequency, drugs_clean$age)

alc_freq_chisq
```

```{r marijuana use and age correlation}
alc_freq_chisq <- chisq.test(drugs_clean$marijuana.use, drugs_clean$age)

alc_freq_chisq
```

```{r marijuana frequency and age correlation}
alc_freq_chisq <- chisq.test(drugs_clean$marijuana.frequency, drugs_clean$age)

alc_freq_chisq
```

```{r hallucinogen use and age correlation}
alc_freq_chisq <- chisq.test(drugs_clean$hallucinogen.use, drugs_clean$age)

alc_freq_chisq
```

```{r hallucinogen frequency and age correlation}
alc_freq_chisq <- chisq.test(drugs_clean$hallucinogen.frequency, drugs_clean$age)

alc_freq_chisq
```

### Unfortunately, none of our chi-squares tests were signficant. This may be due to the way the age groups were coded, or an error in the test I used. Since we are dealing with one categorical variable (age) and one numeric or continuous variable (drug use OR drug frequency), we could attempt to run an analysis of variance test. 

```{r alcohol use by age anova}
alc_use_anova <- aov(alcohol.use ~ age, data = drugs_clean)

anova_output <- summary(alc_use_anova)

print(anova_output)
```

```{r alcohol use by age anova}
marij_use_anova <- oneway.test(age ~ marijuana.use, data = drugs_clean)

anova_output <- summary(marij_use_anova)

print(anova_output)
```

### This test was not signficant (*p* > .05). There is not a significant correlation between alcohol use and the age groups in this sample. 

```{r alcohol frquency and age correlation}
alc_use_chisq <- chisq.test(drugs_clean$alcohol.frequency, drugs_clean$age)

alc_use_chisq
```

### Our Chi-square test was signficant at *p* < .001! *X^2* = 1754.2. This means that there is a correlation between a dog's height and weight, regardless of breed, such that dogs that are taller also tend to weigh more. Of course, this intuitively makes sense.  

#### *Note for Dr. Wiernik: For this correlation test, I chose to use the Chi-square test because height and weight are currently categorical variables. Although I am not sure if this is the correct test, I wanted to gain practice in running correlations in R.*


# Step 10: Let's conduct a one-way Analysis of Variance (ANOVA) test to see if the is a statistically significant difference in the average star rating between the different difficulties of routes.  

```{r anova}
anova <- aov(weight_high_lbs ~ height_high_inches, data = dogs2)

anova_output <- summary(anova)

print(anova_output)
```

### I conducted a one-way ANOVA with route difficultly (NA, V0, V1, V2, V3, V4, V5, V6, V7, V8, V9) as the between-subjects factor. There was sufficient evidence to conclude that route difficulty had an effect on the star rating of the route, *F* (10, 796) = 33.64, *p* < .001. 

#### *Note for Dr. Wiernik: The dataset does not clarify how the scores were measured, so I am not sure if this is between-subjects or within-subjects. For the sake of practice, I chose to interpret the data as between-subjects.*


# Step 11: Since there are more than two levels of the IV (route difficulty), we need to run post-hoc tests to see which diets are significantly different from each other. 

```{r post hoc}
TukeyHSD(anova)
```

### Post hoc tests using a Tukey's HSD adjustment indicated that V0 routes (beginner routes) (*M* = 3.52, *SD* = 0.53) had signficantly lower star ratings than almost all other routes: V2 (*M* = 3.80, *SD* = 0.50), V3 (*M* = 3.97, *SD* = 0.43), V4 (*M* = 4.21, *SD* = 0.46), V5 (*M* = 4.15, *SD* = 0.47), V6 (*M* = 4.32, *SD* = 0.42), V7 (*M* = 4.33, *SD* = 0.39), V8 (*M* = 4.54, *SD* = 0.43), and V9 (*M* = 4.85, *SD* = 0.21). There was no signficant difference in route star rating between V0 and V1 (*M* = 3.55, *SD* = 0.51). V1 routes had signficantly lower star ratings than V2, V3, V4, V5, V6, V7, V8, and V9. V2 routes had signficantly lower star ratings than V4-V8. V3 routes had signficantly lower star ratings than V4, V6, V7, and V8. All other comparions were not signficantly different. 


# **Interpretation of the Findings**

### Based on our analyses, there is a signficant relationship between boulder route difficulty and star rating such that more difficult routes have higher star ratings. This relationship is especially prevalent among the beginner-intermediate routes (V0, V1, V2, and V3), with less differences in star ratings at the most difficult levels of routes. 

### Unfortunately, information about the data is limited, preventing the ability to make clearer interpretations.Primarily, the method of data collection and information about the measures was vague. I am assuming that star rating reflects how much people enjoyed the route for the sake of analyses. 

### If my understanding of the data is correct, then we can infer that people tend to enjoy more difficult routes. Future studies can examine if this relationship still exists when controlling for skill level (i.e., do people still enjoy advanced routes if they are a beginner?). Future studies can also examine what aspects of the route people enjoyed (i.e., location, rock type, hold type, etc.) to aid in developing more enjoyable indoor climbing routes. 



